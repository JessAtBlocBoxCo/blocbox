{% extends "blocbox/basewaitlist.html" %}
<!--this is blocbox/core/templates/bocbox/waitlist-confirmation.html, url is http://www.blocbox.co/waitlistconfirmation/-->
{% load staticfiles %} {% block title %} Join Our Waitlist {% endblock %} {% block topcontent %}

<div class="row-fluid fullheight">
    

    <div class="col-xs-12 col-xs-offset-0 col-sm-6 col-sm-offset-3 col-lg-4 col-lg-offset-4">
        <div class="promo"></div>
        <h2 class="nomargintop signup-padding">Sign Up</h2>
        <h3 class="paddingbottom20pxnomobile" style="font-size: 1.7em">Launching soon in select neighborhoods</h3>

 				<form class="form-horizontal" role="form" method="post" action="." enctype="multipart/form-data">
        
            {% csrf_token %} 
            
            <div class="form-group col-xs-12">   
            		{{ user_form.email.errors|striptags}}
                <input name="email" placeholder="you@example.com" class="form-control input-lg inputbox margintop5pxmobile" type="email">
            </div>
             <div class="form-group col-xs-12">  
                	{{ user_form.full_name.errors|striptags}}
                    <input name="full_name" placeholder="Full Name" class="form-control input-lg inputbox margintop5pxmobile" type="text">
           	</div>
           	
						<div class="form-group col-xs-12">
            		{{ user_form.st_address1.errors|striptags}}
                <input name="st_address1" placeholder="Street Address" class="form-control input-lg inputbox margintop5pxmobile" type="text">
            </div>
            
            <div class="form-group col-xs-12">
            		{{ user_form.zipcode.errors|striptags}}
                <input name="ZIPCODE" placeholder="ZIP" class="form-control input-lg inputbox margintop5pxmobile" type="text">
            </div>
            <div class="form-group col-xs-12">            	
                <input name="referredby"  class="form-control input-lg inputbox margintop5pxmobile" type="hidden"
                	value="{{referring_user_email}}">
            </div>
            
            <div class="col-xs-10 col-xs-offset-1 col-sm-12 col-sm-offset-0 paddingtop10px nopaddingmobile waitlistcheck">
                <div class="checkbox checkbox-success checkbox-inline text-center">
                    <input type="checkbox" name="hostinterest" id="id_hostinterest">
                       <label for="id_hostinterest"> 
                        <h6 class="nomargin textleft paddingleft10px">I'm interested in helping my neighbors and making some extra money</h6>
                    </label>
                </div>
            </div>

            <div class="col-xs-12 paddingtop20px paddingtop15pxmobile">
                <input type="submit" value="Sign Up and Request to Connect" name="submit" class="btn-waitlist margintop5px"> <!--name="subscribe" -->
            </div>
            <!--row -->

            <div id="mce-responses" class="clear">
                <div class="response" id="mce-error-response" style="display:none"></div>
                <div class="response" id="mce-success-response" style="display:none"></div>
            </div>
            <!--row-->
        </form>

<script>
	//from: http://api.jquery.com/jQuery.post/
	//include the javascript file for override the before send thing that is causing error
{% include "javascript_includes/override_beforesend.js" %}
	  $("#mc-embedded-subscribe-form").submit(function(event){	      
			//stop form from submitting normally
			event.preventDefault();
			//Get some values from elements on the page
    		 var PostDataPrep = $(this).serializeArray(),
    		     PostData = JSON.stringify(PostDataPrep),
    		     PostDataMailchimp = $(this).serialize(),
    		     URLbb = ".",
    		     URLmailchimp = $(this).attr("action"),
    		     URLtest = "/test_secondform/";
    		 
    		$.ajax(	{
        		url : URLbb,
        		contentType: "application/json",
        		method: "POST",
            data: PostData,

        success:function(data, textStatus, jqXHR) 
        {	console.log( 'You successfully posted the PostData' + PostData );  },
        
        error: function(xhr, textStatus, thrownError) 
         {
         	console.log( 'the PostDataPrep var is' + PostDataPrep );
         	console.log( 'the PostData var is' + PostData );
         	console.log( 'the URLbb var is ' + URL1 );
          console.log( 'There was an error...error variables shown below');
    			console.log( 'XHR responseText is: ' + xhr.responseText ) ;
    			console.log( 'textStatus is:' + textStatus);
    			console.log( 'thrownError is:' + thrownError);     
        }, 
    });
     
    //guide: http://pocketproduct.com/2014/a-better-mailchimp-signup/  
      $.ajax(	{
        		url : URLmailchimp,       		
        		type: "GET",
        		cache: false,
            data: PostDataMailchimp,
            cache: false,
            dataType: "jsonp",
            jsonp: "c",
            contentType: "application/json; charset=utf-8", 
        
        success:function(data, textStatus, jqXHR) 
        {	
        	   console.log( 'You successfully posted to Mailchimp with the PostDataMailchimp:' + PostDataMailchimp ); 
        	   console.log( 'The data.msg is: ' + data.msg );
        	   
        	    if (data.result != "success") {
                   var message = data.msg || "Sorry. Unable to subscribe. Please try again later.";
                        if (data.msg && data.msg.indexOf("already subscribed") >= 0) {
                            message = "You're already subscribed to the Blocbox Waitlist! <br> If you think this is a mistake please contact us at info@blocbox.co";
                        }
              alert(message);   } 
              else  { window.location.href = "/almostfinished/" }
         },
        
        error: function(xhr, textStatus, thrownError) 
         {
         	console.log( 'the PostDataMailchimp var is' + PostDataMailchimp );
         	console.log( 'the URLmailchimp var is ' + URLmailchimp );
          console.log( 'There was an error...error variables shown below');
    			console.log( 'XHR responseText is: ' + xhr.responseText ) ;
    			console.log( 'textStatus is:' + textStatus);
    			console.log( 'thrownError is:' + thrownError);     
        }, 
    });
      
		//$("#ajaxform").submit();
    //event.unbind(); //unbind. to stop multiple form submit.
});

</script>

 </div>
    <div class="text-center alignbottomdiv mobilehide">
        <a href="#learn">
            <p class="whitetext nomargin">LEARN MORE</p>
            <img src="{% static 'blocbox/images/arrow-white.png' %}" height="50" width="50" />
        </a> 
    </div>
</div>

{% endblock %}